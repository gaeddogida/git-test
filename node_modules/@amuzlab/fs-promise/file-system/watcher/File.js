'use strict'

const path = require('path'),
    fs = require('../index')

class File extends require('./AbstractFile') {
    constructor (filePath, fileName, stat, relativePath, option) {
        super(filePath, fileName, stat, relativePath, option)

        Object.defineProperties(
            this,
            {
                _createCheckTimeout: {
                    writable: true,
                    value: null
                },
                _changeFinishTimeout: {
                    writable: true,
                    value: null
                }
            })
    }

    change () {
        clearTimeout(this._changeFinishTimeout)
        this._changeFinishTimeout = setTimeout(
            () => {
                this.emit('change', this)
            },
            this.option.checkInterval)
    }

    startCheckCreate () {
        this._createCheckTimeout = setTimeout(
            () => {
                let stat = this.stat

                this._createCheckTimeout = null

                this._stat = fs.fs.statSync(path.join(this.filePath, this.fileName))
                this.size === stat.size ? this.emit('create', this) : this.startCheckCreate()
            },
            this.option.checkInterval)
    }

    clear() {
        clearTimeout(this._changeFinishTimeout)
        clearTimeout(this._createCheckTimeout)
    }
}

module.exports = exports = File
